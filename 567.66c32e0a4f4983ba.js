"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[567],{56701:(M,m,i)=>{i.d(m,{g:()=>g});var r=i(54438),h=i(62984),c=i(51188),d=i(3888);let g=(()=>{class l{constructor(s,t,a){this.authservice=s,this.router=t,this.alertService=a}canActivate(s){return!!this.authservice.permissionMatch(s.data.permission)||(this.alertService.error("general.notAllow.notAllowPageMessage"),this.router.navigate(["/"]),!1)}static{this.\u0275fac=function(t){return new(t||l)(r.KVO(h.J),r.KVO(c.Ix),r.KVO(d.u))}}static{this.\u0275prov=r.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},84205:(M,m,i)=>{i.d(m,{t:()=>g});var r=i(67569),h=i(45312),c=i(54438),d=i(21626);let g=(()=>{class l extends r.d{constructor(s){super(s,h.c.apiUrl+"ClientGroup/")}static{this.\u0275fac=function(t){return new(t||l)(c.KVO(d.Qq))}}static{this.\u0275prov=c.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},45943:(M,m,i)=>{i.d(m,{L:()=>g});var r=i(67569),h=i(45312),c=i(54438),d=i(21626);let g=(()=>{class l extends r.d{constructor(s){super(s,h.c.apiUrl+"ProductOffer/")}GetLookups(){return this.http.get(this.baseUrl+"GetLookups")}GetActiveOffer(){return this.http.get(this.baseUrl+"GetActiveOffer")}checkItemOffer(s,t){return this.checkOffers(s,t)}checkOffers(s,t){const a=t.filter(n=>{const u=n.productServicesX.map(O=>O.id),v=s.items.filter(O=>u.includes(O.itemId)&&!O.isFree).reduce((O,D)=>O+D.quantity,0);if(6===n.offerType){const O=n.productOfferQuantities.filter(D=>v>=D.quantityX);if(O.length){const D=O.reduce((S,L)=>L.quantityX>S.quantityX?L:S);return n.quantityX=D.quantityX,n.quantityY=D.quantityY,!0}return!1}return v>=n.quantityX});return 0===a.length?(s.itemsOffers=[],s.items=s.items.filter(n=>!n.isFree),s):(s.itemsOffers=[],s.offerNames=[],a.forEach(n=>{[1,6].includes(n.offerType)&&this.checkOfferXToY(s,n)}),s)}checkOfferXToY(s,t){const a=s.items.reduce((u,_)=>u+(t.productServicesX.some(O=>O.id===_.itemId&&!_.isFree)?_.quantity:0),0);if(t.quantityY=this.getBestQuantity(a,t),s.items.some(u=>t.productServicesX.some(_=>_.id===u.itemId))&&a>=t.quantityX){t.productServicesY.forEach(_=>{_.isSelected=!1,_.quantityY=t.quantityY}),s.offerNames.push({id:t.id,title:t.title,isSelected:!1,count:t.productServicesY.length});const u=6===t.offerType?this.resetQuantityX(t.quantityY,t.productServicesY):t.productServicesY;s.itemsOffers.push(...u)}else s.itemsOffers=[];return this.updateLimit(s)}updateLimit(s){return s.items.filter(t=>t.isFree).forEach(t=>{const a=s.itemsOffers.find(n=>n.id===t.itemId);a&&(t.quantityY=a.quantityY,t.quantity=Math.min(t.quantity,a.quantityY))}),s.items=this.removeExceededOfferItems(s.items),s}removeExceededOfferItems(s){const t={};s.forEach(n=>{const u=n.offerId;t[u]||(t[u]={total:0,max:n.quantityY}),t[u].total+=n.quantity});const a=Object.entries(t).filter(([n,u])=>u.total>u.max).map(([n])=>+n);return s.filter(n=>!a.includes(n.offerId))}resetQuantityX(s,t){return t.map(a=>({...a,quantityY:s}))}getBestQuantity(s,t){let a=s,n=0;const u=[...t.productOfferQuantities].sort((_,v)=>v.quantityX-_.quantityX);for(let _ of u){const v=Math.floor(a/_.quantityX);v>0&&(n+=v*_.quantityY,a-=v*_.quantityX)}return n}static{this.\u0275fac=function(t){return new(t||l)(c.KVO(d.Qq))}}static{this.\u0275prov=c.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},70072:(M,m,i)=>{i.d(m,{A:()=>l});var r=i(84412),h=i(67569),c=i(45312),d=i(54438),g=i(21626);let l=(()=>{class p extends h.d{constructor(t){super(t,c.c.apiUrl+"OfferOrder/"),this.checkValidationSource=new r.t(!0),this.checkValidation=this.checkValidationSource.asObservable(),this.GetOrderCountSource=new r.t(!0),this.GetOrderCount=this.GetOrderCountSource.asObservable(),this.removeServiceQ=new r.t(0),this.removeService=this.removeServiceQ.asObservable(),this.removeServiceOfferQ=new r.t(0),this.removeServiceOffer=this.removeServiceOfferQ.asObservable(),this.discountTypes=[{id:1,name:"Cost"},{id:2,name:"Precentage"}],this.salesOrderForm={itemsOffers:[],id:null,clientLocationId:0,clientVisitDate:new Date,clientId:0,notes:"",items:[],discountAmount:0,discountAmountAdd:0,total:0,agent:{},orderLocations:{},discountType:1,discountTypeAdd:1,isPrecentage:!0,isPrecentageAdd:!1,totalAddDiscountType:0,totalAddDiscount:0,serviceCategoryCode:0,isCustomerDataValid:!1},this.requesturl=c.c.apiUrl+"salesRequest/"}getLookups(){return this.http.get(this.baseUrl+"Lookups")}changStatus(t){return this.http.put(this.baseUrl+"ChangeStatus/",t)}UpdateQuantity(t){return this.http.put(this.baseUrl+"UpdateQuantity",t)}updateTruck(t){return this.http.put(this.baseUrl+"updateTruck",t)}GetTrucks(t){return this.http.post(this.baseUrl+"GetTrucks/",t)}CancelOfferOrder(t){return this.http.post(this.baseUrl+"CancelOfferOrder",t)}GetOfferOrderCount(){return this.http.get(this.baseUrl+"OfferOrderCount")}GetOfferOrderStoreCount(){return this.http.get(this.baseUrl+"GetOfferOrderStoreCount")}GetAssignSalesOrder(){return this.http.get(this.baseUrl+"GetAssignSalesOrder")}GetOrderDetail(t){return this.http.get(this.baseUrl+"GetOrderDetail/"+t)}RequestChangeQuantity(t){return this.http.post(this.baseUrl+"RequestChangeQuantity/",t)}GetOrderStore(t){return this.http.post(this.baseUrl+"GetOrderStore/",t)}PrintSalesOrder(t){return this.http.get(this.baseUrl+"PrintSalesOrder/"+t,{responseType:"blob"})}PrintStoreReport(t){return this.http.get(this.baseUrl+"PrintStoreReport/"+t,{responseType:"blob"})}registerRequestSales(t){return this.http.post(this.requesturl+"register",t)}static{this.\u0275fac=function(a){return new(a||p)(d.KVO(g.Qq))}}static{this.\u0275prov=d.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},56131:(M,m,i)=>{i.d(m,{E:()=>c});var r=i(7673),h=i(99437);class c{constructor(g,l,p){this.router=g,this.BaseService=l,this.alertService=p,this.pagination={pageNumber:1,pageSize:10}}resolve(g,l){return this.BaseService.get(this.pagination).pipe((0,h.W)(p=>(this.router.navigate([""]),this.alertService.error(p),(0,r.of)(null))))}}},75622:(M,m,i)=>{i.d(m,{w:()=>P});var r=i(21413),h=i(56977),c=i(37021),d=i(35335),g=i(45236),l=i(70980),p=i(99437),s=i(18810),t=i(45286),a=i(36158),n=i(54438),u=i(51188),_=i(8147),v=i(69005),O=i(67569),D=i(3888),S=i(60177),L=i(1530);let P=(()=>{class I{constructor(e,o,f,E,C,y,b){this.routerActive=e,this.translateService=o,this.modalService=f,this.baseService=E,this.alertService=C,this.datePipe=y,this.ngxLoader=b,this.title="",this.mainDelay=50,this.operationId=0,this.entities=[],this.selectedRow=[],this.pagination={pageNumber:1,pageSize:10},this.notifier=new r.B,this.checkAll=!1,this.checkOne=!1,this.checkMore=!1,this.loader=!1,this.form={},this.isEditForm=!1,this.draw=1,this.index=0,this.lengthSelect=0,this.screenName="",this.filterToggle=!0,this.start=1,this.startFirstLoad=!0,this.btnDisabled=!0,this.loaderSearchShap=a.cX,this.loaderOperationShap=a.$$,this.operationLoader=a.ZW,this.loaderDeleteShap=a.jg,this.mainTable=a.uG,this.searchLoader=a.a7,this.deleteLoader=a.Fq,this.langArabic="ar",this.paymentTypes=[],this.tableLengthSelect=[10,20,30,50,100,500,1e3],this.maxSizePagination=10,this.isResolveList=!1,this.countLoad=0,this.activeList=[{id:1,name:"active"},{id:2,name:"noActive"}],this.pagination.pageSize=10,this.pagination.pageNumber=1}ngOnInit(){this.activeList.forEach(e=>{e.name=this.getTranslationText("general.table."+e.name)}),this.lang=this.translateService.currentLang,this.translateConfig(),this.ngOnInitMore()}ngOnInitMore(){}routeDataConfig(){this.routerActive.data.pipe((0,h.Q)(this.notifier)).subscribe(e=>{this.entities=e.data.result,this.pagination=e.data.pagination,this.pagination.pageNumber=1,this.pagination.pageSize=10,this.ngxLoader.stopLoader(a.a7)},e=>{this.alertService.error()})}translateConfig(){this.translateService.onLangChange.pipe((0,h.Q)(this.notifier)).subscribe(e=>{this.lang=e.lang})}getTranslationText(e){let o="";return this.translateService.get(e).pipe((0,h.Q)(this.notifier)).subscribe(f=>{o=f}),o}ngAfterViewInit(){this.ngAfterViewInitMore()}ngAfterViewInitMore(){}getRenderString(e){return null!=e?e.substring(0,10)+"...":""}getRenderIndex(e){return this.index++,this.index}successDataTable(e){this.ngxLoader.stopLoader(a.a7),this.pagination.totalItems=e.data.pagination.totalItems,this.startFirstLoad=!1}errorDataTable(){this.ngxLoader.stopLoader(a.a7),this.alertService.error()}openModalTitle(e,o="md"){this.isEditForm=!1,this.form={},this.modalService.open(e,{centered:!0,size:o})}openModal(e,o,f="md"){this.isEditForm=!1,this.form={},this.selectedRow=[{id:e}],this.operationId=e,this.modalService.open(o,{centered:!0,size:f})}openModalMoreOperation(e){this.isEditForm=!1,this.moreIdSelected=this.selectedRow.map(o=>o.id)}closeModelDeleted(){this.modalRef?.hide(),this.loader=!1,this.btnDisabled=!0}OnSearch(e){this.ngxLoader.startLoader("allLoader"),this.loadentities()}OnSubmit(){this.ngxLoader.startLoader(this.operationLoader),!0===this.isEditForm?this.editEntity():this.registerEntity()}loadentities(){this.baseService.get(this.pagination).pipe((0,h.Q)(this.notifier)).subscribe(e=>{this.ngxLoader.stopLoader(a.a7),this.entities=e.data,this.pagination.totalItems=e.totalItems,this.LoadSuccess()},e=>{this.ngxLoader.stopLoader(a.a7),this.alertService.error(e)}),this.checkMore=this.checkOne=this.checkAll=!1,this.lengthSelect=0,this.selectedRow=[]}LoadSuccess(){}tableChange(e){this.pagination.filterType=e.sortField,this.pagination.sortType=1==e.sortOrder?"asc":"desc",this.loadentities()}registerEntity(){let e=this.mapRegisterForm(this.form);this.baseService.register(e).pipe((0,c.O)(),(0,d.c)(this.mainDelay),(0,g.Z)(),(0,h.Q)(this.notifier),(0,l.j)(()=>this.ngxLoader.stopLoader(this.operationLoader)),(0,p.W)(o=>(0,s.$)(o))).subscribe(o=>{o.success?this.submitFunished():this.alertService.error("general.message."+o.message)},o=>{this.alertService.error("general.message."+o)})}editEntity(){let e=this.mapForm(this.form);this.baseService.edit(e.id,e).pipe((0,c.O)(),(0,d.c)(this.mainDelay),(0,g.Z)(),(0,h.Q)(this.notifier),(0,l.j)(()=>this.ngxLoader.stopLoader(this.operationLoader))).subscribe(o=>{o.success?this.submitFunished():this.alertService.error("general.message."+o.message)},o=>{this.alertService.error("general.message."+o)})}mapForm(e){return e}mapRegisterForm(e){return e.id=0,e}submitFunished(){this.loadentities(),this.alertService.success(),this.modalService?.dismissAll(),this.ngxLoader.stop(a.a7),this.btnDisabled=!0}EditModel(e,o,f="md"){this.isEditForm=!0,this.baseService.getById(e).pipe((0,h.Q)(this.notifier)).subscribe(E=>{E.success?this.form=E.data:this.alertService.error("general.message."+E.message),this.modalService.open(o,{centered:!0,size:f})},E=>{this.alertService.error()})}EditModelTilte(e){this.isEditForm=!0,this.baseService.getById(this.selectedRow[0].id).pipe((0,h.Q)(this.notifier)).subscribe(f=>{f?this.form=f:this.alertService.error("general.message."+f)},f=>{this.alertService.error()})}onSelectionChange(e){this.selectedRow=e,this.lengthSelect=e.length}resetSelected(){this.selectedRow=[],this.lengthSelect=0}pageChanged(e){this.pagination.pageNumber=e,this.loadentities()}ListItemChange(e){this.pagination.pageSize=e.target.value,this.loadentities()}searchChange(e){this.pagination.filterValue=e,this.loadentities()}DeleteConfirm(){this.ngxLoader.startLoader(a.Fq);let e=this.selectedRow.map(o=>o.id);this.baseService.deleteRange(e).pipe((0,c.O)(),(0,d.c)(this.mainDelay),(0,g.Z)(),(0,h.Q)(this.notifier),(0,l.j)(()=>this.ngxLoader.stopLoader(a.Fq))).subscribe(o=>{o.success?(this.alertService.success(),this.loadentities(),this.modalService.dismissAll(),this.resetSelected()):this.alertService.error("general.message."+o)},()=>{this.alertService.error()})}DeleteConfirmSoft(){console.log(this.selectedRow,"selectedRow"),this.ngxLoader.startLoader(a.Fq),this.baseService.softDelete(this.selectedRow[0].id).pipe((0,c.O)(),(0,d.c)(this.mainDelay),(0,g.Z)(),(0,h.Q)(this.notifier),(0,l.j)(()=>this.ngxLoader.stopLoader(a.Fq))).subscribe(e=>{e.success?(this.alertService.success(),this.loadentities(),this.modalService.dismissAll(),this.resetSelected()):this.alertService.error("general.message."+e)},()=>{this.alertService.error()})}getIds(){return this.selectedRow.map(e=>e.id)}isEmpty(e){return(void 0===e||null==e||e.length)<=0}OnReset(e){this.form={},this.pagination={pageSize:10,pageNumber:1,totalItems:this.pagination.totalItems}}onReset(){this.form={},this.pagination={pageSize:10,pageNumber:1,totalItems:this.pagination.totalItems}}closeModel(e){this.modalRef?.hide()}ngOnDestroy(){this.notifier.next(),this.notifier.complete(),this.OnDestroyMore()}OnDestroyMore(){}static{this.\u0275fac=function(o){return new(o||I)(n.rXU(u.nX),n.rXU(_.c$),n.rXU(v.Bq),n.rXU(O.d),n.rXU(D.u),n.rXU(S.vh),n.rXU(L.eD))}}static{this.\u0275cmp=n.VBU({type:I,selectors:[["app-base"]],viewQuery:function(o,f){if(1&o&&n.GBs(t.XI,5),2&o){let E;n.mGM(E=n.lsd())&&(f.tableMaster=E.first)}},decls:0,vars:0,template:function(o,f){},encapsulation:2})}}return I})()},88148:(M,m,i)=>{i.d(m,{p:()=>c});var r=i(54438),h=i(8147);let c=(()=>{class d{static{this.\u0275fac=function(p){return new(p||d)}}static{this.\u0275cmp=r.VBU({type:d,selectors:[["ngb-pagination-info"]],inputs:{pagination:"pagination"},decls:6,vars:2,consts:[[1,"d-inline-block","mx-1","text-pInfo"],["translate","general.table.pFrom",1,"text-pInfo"],["translate","general.table.item",1,"text-pInfo"]],template:function(p,s){1&p&&(r.j41(0,"span",0),r.EFF(1),r.k0s(),r.nrm(2,"span",1),r.j41(3,"span",0),r.EFF(4),r.k0s(),r.nrm(5,"span",2)),2&p&&(r.R7$(),r.JRh(s.pagination.totalItems>s.pagination.pageNumber*s.pagination.pageSize?s.pagination.pageNumber*s.pagination.pageSize:s.pagination.totalItems),r.R7$(3),r.JRh(s.pagination.totalItems))},dependencies:[h.Mm],styles:[".text-pInfo[_ngcontent-%COMP%]{font-size:.7rem;color:#8a96a0}"]})}}return d})()},91580:(M,m,i)=>{i.d(m,{g:()=>g});var r=i(54438),h=i(60177),c=i(89417);function d(l,p){if(1&l&&(r.j41(0,"option"),r.EFF(1),r.k0s()),2&l){const s=p.$implicit;r.R7$(),r.JRh(s)}}let g=(()=>{class l{constructor(){this.lengthChange=new r.bkB}ListItemChange(s){this.lengthChange.emit(s)}static{this.\u0275fac=function(t){return new(t||l)}}static{this.\u0275cmp=r.VBU({type:l,selectors:[["table-length"]],inputs:{lengthTable:"lengthTable"},outputs:{lengthChange:"lengthChange"},decls:4,vars:1,consts:[[1,"card-toolbar","mx-2"],[1,"fs-2","text-primary"],[1,"form-select","mx-2","d-inline","form-select-sm","w-auto",3,"change"],[4,"ngFor","ngForOf"]],template:function(t,a){1&t&&(r.j41(0,"div",0),r.nrm(1,"span",1),r.j41(2,"select",2),r.bIt("change",function(u){return a.ListItemChange(u)}),r.DNE(3,d,2,1,"option",3),r.k0s()()),2&t&&(r.R7$(3),r.Y8G("ngForOf",a.lengthTable))},dependencies:[h.Sq,c.xH,c.y7],encapsulation:2})}}return l})()}}]);